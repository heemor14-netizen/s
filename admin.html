<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Cairo',sans-serif;
  background:#0f172a;
  color:#fff;
}
.container{
  max-width:900px;
  margin:40px auto;
  background:#fff;
  color:#1e293b;
  padding:30px;
  border-radius:18px;
}
h1{margin-bottom:20px}
input,select,textarea,button{
  width:100%;
  padding:12px;
  margin-bottom:15px;
  border-radius:10px;
  border:1px solid #cbd5f5;
  font-family:'Cairo';
}
textarea{resize:vertical;min-height:100px}
button{
  background:#2563eb;
  color:#fff;
  border:none;
  cursor:pointer;
  font-size:16px;
}
button:hover{opacity:.9}
.card{
  border:1px solid #e5e7eb;
  border-radius:14px;
  padding:15px;
  margin-bottom:15px;
}
.actions button{
  width:auto;
  margin-left:10px;
}
.back{
  margin-top:30px;
  background:#334155;
}
</style>
</head>

<body>

<div class="container">
<h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>

<form id="form">
  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø©" required>
  <input id="spec" placeholder="ÙˆØµÙ / ØªØ®ØµØµ Ø§Ù„ÙˆØ±Ø´Ø©" required>

  <select id="cat" required>
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
    <option value="cars">Ø³ÙŠØ§Ø±Ø§Øª</option>
    <option value="metal">Ø­Ø¯Ø§Ø¯Ø©</option>
    <option value="sofa">ÙƒÙ†Ø¨</option>
    <option value="aluminum">Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
  </select>

  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)" pattern="[0-9]+" required>

  <input id="map" placeholder="Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆØ±Ø´Ø© Ù…Ù† Google Maps" required>

  <!-- ğŸ‘‡ Ø§Ù„ØµÙˆØ± Ø¨Ø±ÙˆØ§Ø¨Ø· ÙÙ‚Ø· -->
  <textarea id="images"
    placeholder="Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 6)\nÙƒÙ„ Ø±Ø§Ø¨Ø· ÙÙŠ Ø³Ø·Ø± Ù„Ø­Ø§Ù„Ù‡"></textarea>

  <button type="submit">Ø­ÙØ¸ Ø§Ù„ÙˆØ±Ø´Ø©</button>
</form>

<h2>Ø§Ù„ÙˆØ±Ø´ Ø§Ù„Ù…Ø¶Ø§ÙØ©</h2>
<div id="list"></div>

<button class="back" onclick="location.href='index.html'">â¬…ï¸ Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ÙˆÙ‚Ø¹</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  getDocs, deleteDoc, doc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBdhesRwD2eiDvqqcMGhC59U4whICwTO3E",
  authDomain: "sanaeya-samtah.firebaseapp.com",
  projectId: "sanaeya-samtah",
  storageBucket: "sanaeya-samtah.firebasestorage.app",
  messagingSenderId: "1092994215610",
  appId: "1:1092994215610:web:e68b5a3eccb24235d39c83"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const form = document.getElementById("form");
const list = document.getElementById("list");

let editId = null;

form.onsubmit = async e => {
  e.preventDefault();

  const imagesArr = images.value
    .split("\n")
    .map(i => i.trim())
    .filter(i => i)
    .slice(0,6);

  const data = {
    name: name.value.trim(),
    spec: spec.value.trim(),
    cat: cat.value,
    phone: phone.value.trim(),
    map: map.value.trim(),
    images: imagesArr
  };

  if(editId){
    await updateDoc(doc(db,"workshops",editId), data);
    editId = null;
  }else{
    await addDoc(collection(db,"workshops"), data);
  }

  form.reset();
  load();
  alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­");
};

async function load(){
  list.innerHTML = "";
  const q = await getDocs(collection(db,"workshops"));
  q.forEach(d=>{
    const w = d.data();
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <b>${w.name}</b><br>
      ${w.spec}<br>
      ğŸ“ ${w.phone}<br>
      ğŸ—ºï¸ <a href="${w.map}" target="_blank">Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a><br>
      ğŸ–¼ï¸ ${w.images?.length || 0} ØµÙˆØ±Ø©
      <div class="actions">
        <button onclick="edit('${d.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
        <button onclick="del('${d.id}')">Ø­Ø°Ù</button>
      </div>
    `;
    list.appendChild(div);
  });
}

window.edit = async id=>{
  const q = await getDocs(collection(db,"workshops"));
  q.forEach(d=>{
    if(d.id===id){
      const w=d.data();
      name.value=w.name;
      spec.value=w.spec;
      cat.value=w.cat;
      phone.value=w.phone;
      map.value=w.map;
      images.value=(w.images||[]).join("\n");
      editId=id;
    }
  });
};

window.del = async id=>{
  if(confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")){
    await deleteDoc(doc(db,"workshops",id));
    load();
  }
};

load();
</script>
</body>
</html>
