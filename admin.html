<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | ØµÙ†Ø§Ø¹ÙŠØ© ØµØ§Ù…Ø·Ø©</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Cairo',sans-serif;
  background:#0f172a;
  color:#fff;
}
.container{
  width:95%;
  max-width:900px;
  margin:40px auto;
}
h1{margin-bottom:20px}
form{
  background:#fff;
  color:#1e293b;
  padding:25px;
  border-radius:16px;
}
input,select,textarea,button{
  width:100%;
  padding:12px;
  margin-bottom:14px;
  border-radius:10px;
  border:1px solid #ccc;
  font-family:'Cairo';
}
textarea{resize:vertical}
button{
  background:#2563eb;
  color:#fff;
  border:none;
  cursor:pointer;
}
.success{
  background:#dcfce7;
  color:#166534;
  padding:10px;
  border-radius:10px;
  margin-bottom:15px;
  display:none;
}
.cards{
  margin-top:40px;
  display:grid;
  gap:16px;
}
.card{
  background:#fff;
  color:#1e293b;
  padding:16px;
  border-radius:14px;
}
.card img{
  width:100%;
  max-height:160px;
  object-fit:cover;
  border-radius:10px;
  margin-top:8px;
}
.actions{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.delete{background:#dc2626}
.edit{background:#16a34a}
</style>
</head>

<body>
<div class="container">

<h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ø§Ù„ÙˆØ±Ø´</h1>

<div class="success" id="successMsg">âœ… ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</div>

<form id="form">
  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø©" required>
  <textarea id="desc" placeholder="ÙˆØµÙ Ø§Ù„ÙˆØ±Ø´Ø©" required></textarea>

  <select id="cat" required>
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
    <option value="cars">Ø³ÙŠØ§Ø±Ø§Øª</option>
    <option value="metal">Ø­Ø¯Ø§Ø¯Ø©</option>
    <option value="sofa">ÙƒÙ†Ø¨</option>
    <option value="aluminum">Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
  </select>

  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„" inputmode="numeric" pattern="[0-9]*" required>

  <button type="button" onclick="openMaps()">ğŸ“ Ø§ÙØªØ­ Ù‚ÙˆÙ‚Ù„ Ù…Ø§Ø¨ Ù„Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
  <input id="map" placeholder="Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆØ±Ø´Ø©" required>

  <!-- ØµÙˆØ± -->
  <input type="file" id="images" accept="image/*" multiple>
  <small>Ø­Ø¯ Ø£Ù‚ØµÙ‰ 6 ØµÙˆØ±</small>

  <button type="submit">Ø­ÙØ¸ Ø§Ù„ÙˆØ±Ø´Ø©</button>
</form>

<div class="cards" id="list"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL }
from "https://www.gstatic.com/firebasejs/10.6.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBdhesRwD2eiDvqqcMGhC59U4whICwTO3E",
  authDomain: "sanaeya-samtah.firebaseapp.com",
  projectId: "sanaeya-samtah",
  storageBucket: "sanaeya-samtah.firebasestorage.app",
  messagingSenderId: "1092994215610",
  appId: "1:1092994215610:web:e68b5a3eccb24235d39c83"
};

const nameInput = document.getElementById("name");
const descInput = document.getElementById("desc");
const catInput = document.getElementById("cat");
const phoneInput = document.getElementById("phone");
const mapInput = document.getElementById("map");


window.openMaps = () => window.open("https://www.google.com/maps","_blank");

form.onsubmit = async (e)=>{
  e.preventDefault();

  const files = document.getElementById("images").files;
  if(files.length > 6){
    alert("Ø­Ø¯ Ø£Ù‚ØµÙ‰ 6 ØµÙˆØ±");
    return;
  }

  const imagesURLs = [];
  for(const file of files){
    const imgRef = ref(storage, `workshops/${Date.now()}_${file.name}`);
    await uploadBytes(imgRef, file);
    imagesURLs.push(await getDownloadURL(imgRef));
  }

const data = {
  name: w.name,
  desc: w.desc,
  cat: w.cat,
  phone: w.phone,
  map: w.map,
  images: imagesURLs
};

nameInput.value = w.name;
descInput.value = w.desc;
catInput.value = w.cat;
phoneInput.value = w.phone;
mapInput.value = w.map || "";


  if(editId){
    await updateDoc(doc(db,"workshops",editId),data);
    editId=null;
  }else{
    await addDoc(collection(db,"workshops"),data);
  }

  successMsg.style.display="block";
  setTimeout(()=>successMsg.style.display="none",3000);
  form.reset();
  load();
};

async function load(){
  list.innerHTML="";
  const q = await getDocs(collection(db,"workshops"));
  q.forEach(d=>{
    const w=d.data();
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <h3>${w.name}</h3>
      <p>${w.desc}</p>
      ${(w.images||[]).map(i=>`<img src="${i}">`).join("")}
      <div class="actions">
        <button class="edit">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="delete">Ø­Ø°Ù</button>
      </div>
    `;
    c.querySelector(".delete").onclick=async()=>{
      await deleteDoc(doc(db,"workshops",d.id));
      load();
    };
    c.querySelector(".edit").onclick=()=>{
      name.value=w.name;
      desc.value=w.desc;
      cat.value=w.cat;
      phone.value=w.phone;
      map.value=w.map;
      editId=d.id;
      scrollTo({top:0,behavior:"smooth"});
    };
    list.appendChild(c);
  });
}
load();
</script>
</body>
</html>


