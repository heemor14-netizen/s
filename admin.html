<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    form, .workshop {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    input, textarea, button {
      width: 100%;
      margin: 6px 0;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #2e7d32;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #1b5e20;
    }
    .images img {
      width: 80px;
      margin: 4px;
      border-radius: 8px;
    }
    .actions button {
      margin-top: 5px;
      background: #444;
    }
    .delete {
      background: #c62828 !important;
    }
  </style>
</head>

<body>

<h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´</h2>

<form id="workshopForm">
  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø©" required>
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (ÙˆØ§ØªØ³)" type="tel" pattern="[0-9]+" required>
  <textarea id="description" placeholder="ÙˆØµÙ Ø§Ù„ÙˆØ±Ø´Ø©" required></textarea>

  <input id="locationLink" placeholder="Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆØ±Ø´Ø© Ù…Ù† Ù‚ÙˆÙ‚Ù„ Ù…Ø§Ø¨" required>

  <label>ØµÙˆØ± Ø§Ù„ÙˆØ±Ø´Ø© (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 6)</label>
  <input type="file" id="imagesInput" accept="image/*" multiple>
<button type="button" onclick="openGoogleMaps()">
  ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Google Maps
</button>

  <button type="submit">Ø­ÙØ¸ Ø§Ù„ÙˆØ±Ø´Ø©</button>
</form>

<div id="workshops"></div>

<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs,
    deleteDoc, doc, updateDoc
  } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
  import {
    getStorage, ref, uploadBytes, getDownloadURL
  } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-storage.js";
window.openGoogleMaps = () => {
  window.open("https://www.google.com/maps", "_blank");
};

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBdhesRwD2eiDvqqcMGhC59U4whICwTO3E",
    authDomain: "sanaeya-samtah.firebaseapp.com",
    projectId: "sanaeya-samtah",
    storageBucket: "sanaeya-samtah.firebasestorage.app",
    messagingSenderId: "1092994215610",
    appId: "1:1092994215610:web:e68b5a3eccb24235d39c83"
  };

  // Init
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const form = document.getElementById("workshopForm");
  const workshopsDiv = document.getElementById("workshops");

  async function uploadImages(files, workshopId) {
    const urls = [];
    for (let file of files) {
      const imageRef = ref(
        storage,
        `workshops/${workshopId}/${Date.now()}_${file.name}`
      );
      await uploadBytes(imageRef, file);
      const url = await getDownloadURL(imageRef);
      urls.push(url);
    }
    return urls;
  }

  form.onsubmit = async (e) => {
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const description = document.getElementById("description").value.trim();
    const locationLink = document.getElementById("locationLink").value.trim();
    const files = document.getElementById("imagesInput").files;

    if (files.length > 6) {
      alert("Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 6 ØµÙˆØ±");
      return;
    }

    const docRef = await addDoc(collection(db, "workshops"), {
      name,
      phone,
      description,
      locationLink,
      images: [],
      createdAt: Date.now()
    });

    let imageUrls = [];
    if (files.length > 0) {
      imageUrls = await uploadImages(files, docRef.id);
    }

    await updateDoc(doc(db, "workshops", docRef.id), {
      images: imageUrls
    });

    alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ±Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    form.reset();
    loadWorkshops();
  };

  async function loadWorkshops() {
    workshopsDiv.innerHTML = "";
    const snap = await getDocs(collection(db, "workshops"));

    snap.forEach(d => {
      const w = d.data();

      const div = document.createElement("div");
      div.className = "workshop";

      div.innerHTML = `
        <strong>${w.name}</strong><br>
        ${w.description}<br>
        <a href="https://wa.me/966${w.phone}" target="_blank">${w.phone}</a><br>
        <a href="${w.locationLink}" target="_blank">Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>
        <div class="images"></div>
        <div class="actions">
          <button class="delete">Ø­Ø°Ù</button>
        </div>
      `;

      const imagesDiv = div.querySelector(".images");
      w.images?.forEach(url => {
        const img = document.createElement("img");
        img.src = url;
        imagesDiv.appendChild(img);
      });

      div.querySelector(".delete").onclick = async () => {
        if (confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) {
          await deleteDoc(doc(db, "workshops", d.id));
          loadWorkshops();
        }
      };

      workshopsDiv.appendChild(div);
    });
  }

  loadWorkshops();
</script>

</body>
</html>
