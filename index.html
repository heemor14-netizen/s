<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© | ØµÙ†Ø§Ø¹ÙŠØ© ØµØ§Ù…Ø·Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --accent:#2563eb;
  --card:#ffffff;
  --text:#1e293b;
  --muted:#64748b;
  --star:#facc15;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Cairo',sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:#fff;
}
header{text-align:center;padding:40px 20px}
header p{color:#cbd5f5}
.search-box{max-width:500px;margin:30px auto}
.search-box input{width:100%;padding:14px;border-radius:12px;border:none}
.container{width:90%;max-width:1200px;margin:40px auto}
.section{margin-bottom:60px}
.section h2{border-right:6px solid var(--accent);padding-right:15px}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:22px}
.card{background:var(--card);color:var(--text);border-radius:16px;padding:22px;box-shadow:0 15px 35px rgba(0,0,0,.2);cursor:pointer;position:relative}
.card h3{margin:0}
.card p{color:var(--muted);font-size:14px}
.rating{color:var(--star);margin:6px 0}
.location{font-size:13px;color:#475569}
.dashboard{background:#fff;color:var(--text);padding:30px;border-radius:18px;margin-top:30px}
.dashboard input,select,button{width:100%;padding:12px;margin-bottom:15px;border-radius:10px}
.dashboard button{background:var(--accent);color:#fff;border:none;font-size:16px;cursor:pointer}
footer{text-align:center;padding:25px;color:#cbd5f5}
.delete-btn{position:absolute;top:10px;right:10px;background:red;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;}
</style>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD5MrbyqmXoGgFKB_gvY6DX_5bGdbTyh9o",
  authDomain: "heemo-d02f2.firebaseapp.com",
  projectId: "heemo-d02f2",
  storageBucket: "heemo-d02f2.appspot.com",
  messagingSenderId: "777552011368",
  appId: "1:777552011368:web:8dc7e8cc00644b23dc9bdd",
  measurementId: "G-B9FM723F42"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ADMIN_EMAIL = "heemoxo41430@gmail.com"; // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯

function isAdmin() {
  const user = JSON.parse(localStorage.getItem('user'));
  return user && user.email === ADMIN_EMAIL;
}

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
window.handleCredentialResponse = function(response) {
  const token = response.credential;
  const data = JSON.parse(atob(token.split('.')[1]));
  const user = { name: data.name, email: data.email };
  localStorage.setItem('user', JSON.stringify(user));
  document.getElementById('userStatus').innerText = `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ ${user.name}`;
  reloadWorkshops();
}

// Ø¥Ø¶Ø§ÙØ© ÙˆØ±Ø´Ø©
window.addWorkshop = async function() {
  if (!isAdmin()) { alert('Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù…Ø®ØµØµØ© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·'); return; }

  const w = {
    name: name.value,
    spec: spec.value,
    cat: category.value,
    phone: phone.value,
    loc: loc.value,
    rate: rate.value
  };

  try {
    await addDoc(collection(db, "workshops"), w);
    reloadWorkshops();
    name.value=''; spec.value=''; phone.value=''; loc.value='';
  } catch (err) {
    console.error(err);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ±Ø´Ø©.');
  }
}

// Ø­Ø°Ù ÙˆØ±Ø´Ø©
window.deleteWorkshop = async function(id) {
  if (!isAdmin()) { alert('Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù…Ø®ØµØµØ© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·'); return; }
  try {
    await deleteDoc(doc(db, "workshops", id));
    reloadWorkshops();
  } catch (err) {
    console.error(err);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„ÙˆØ±Ø´Ø©.');
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±Ø´
function renderWorkshop(w) {
  let stars = 'â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†'.slice(5 - w.rate, 10 - w.rate);
  const card = document.createElement('div');
  card.className = 'card';
  card.dataset.search = w.name + ' ' + w.spec;
  card.innerHTML = `
    <h3>${w.name}</h3>
    <p>${w.spec}</p>
    <div class="rating">${stars}</div>
    <div class="location">ğŸ“ ${w.phone}</div>
    <div class="location">ğŸ“ ${w.loc}</div>
  `;
  if(isAdmin()){
    const btn = document.createElement('button');
    btn.className='delete-btn';
    btn.innerText='Ø­Ø°Ù';
    btn.onclick = (e) => { e.stopPropagation(); deleteWorkshop(w.id); }
    card.appendChild(btn);
  }
  card.onclick = () => openDetails(card);
  document.getElementById(w.cat+'Cards').appendChild(card);
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ±Ø´
async function reloadWorkshops() {
  document.getElementById('carsCards').innerHTML='';
  document.getElementById('generalCards').innerHTML='';
  const querySnapshot = await getDocs(collection(db, "workshops"));
  querySnapshot.forEach(docSnap=>{
    let w = docSnap.data();
    w.id = docSnap.id;
    renderWorkshop(w);
  });
}

// ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ±Ø´Ø©
window.openDetails = function(card){
  const w = {
    name: card.querySelector('h3').innerText,
    spec: card.querySelector('p').innerText,
    phone: card.querySelectorAll('.location')[0].innerText,
    loc: card.querySelectorAll('.location')[1].innerText
  };
  localStorage.setItem('currentWorkshop', JSON.stringify(w));
  window.location.href='details.html';
}

// Ø§Ù„Ø¨Ø­Ø«
document.getElementById('search').addEventListener('keyup', e=>{
  let v = e.target.value.toLowerCase();
  document.querySelectorAll('.card').forEach(c=>{
    c.style.display = c.dataset.search.toLowerCase().includes(v)?'block':'none';
  });
});

window.onload = function(){
  const user = JSON.parse(localStorage.getItem('user'));
  if(user){
    document.getElementById('userStatus').innerText = `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ ${user.name}`;
  }
  reloadWorkshops();
}
</script>
</head>
<body>

<header>
  <h1>Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© â€“ ØµÙ†Ø§Ø¹ÙŠØ© ØµØ§Ù…Ø·Ø©</h1>
  <p>Ø¯Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ ÙŠØ¬Ù…Ø¹ ÙˆØ±Ø´ ÙˆØµÙ†Ø§ÙŠØ¹ÙŠØ© ØµÙ†Ø§Ø¹ÙŠØ© ØµØ§Ù…Ø·Ø©</p>
  <div class="search-box">
    <input type="text" id="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† ØªØ®ØµØµ Ø£Ùˆ Ø§Ø³Ù… ÙˆØ±Ø´Ø©">
  </div>
</header>

<div class="container">

<section class="section">
<h2>ØµÙ†Ø§Ø¹ÙŠØ§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h2>
<div class="cards" id="carsCards"></div>
</section>

<section class="section">
<h2>Ø§Ù„ÙˆØ±Ø´ Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
<div class="cards" id="generalCards"></div>
</section>

<section class="section">
<h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„ØµÙ†Ø§ÙŠØ¹ÙŠ</h2>
<div class="dashboard">
  <div id="g_id_onload"
       data-client_id="270081556974-dbvblq6cd4g63339hevqkhlvsd50ac0g.apps.googleusercontent.com"
       data-callback="handleCredentialResponse">
  </div>
  <div class="g_id_signin"></div>

  <p id="userStatus"></p>

  <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø©">
  <input id="spec" placeholder="Ø§Ù„ØªØ®ØµØµ">
  <select id="category">
    <option value="cars">ØµÙ†Ø§Ø¹ÙŠØ§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>
    <option value="general">Ø§Ù„ÙˆØ±Ø´ Ø§Ù„Ø¹Ø§Ù…Ø©</option>
  </select>
  <input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„">
  <input id="loc" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹">
  <select id="rate">
    <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
    <option value="4">â˜…â˜…â˜…â˜…â˜†</option>
    <option value="3">â˜…â˜…â˜…â˜†â˜†</option>
  </select>
  <button onclick="addWorkshop()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ±Ø´Ø©</button>
</div>
</section>

</div>
<footer>Â© 2025 Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© â€“ ØµÙ†Ø§Ø¹ÙŠØ© ØµØ§Ù…Ø·Ø©</footer>

</body>
</html>
